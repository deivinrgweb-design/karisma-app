<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Slot Machine Karisma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --karisma-black: #000000;
      --karisma-white: #ffffff;
      --karisma-turquoise: #00c9c8;
      --karisma-turquoise-dark: #00a3a2;
      --border-radius-main: 16px;
      --transition-fast: 0.2s ease-out;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, sans-serif;
    }
    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
      background: radial-gradient(circle at top, #071d1d, #000000 45%, #02070a);
      color: var(--karisma-white);
    }
    .app {
      width: 100%;
      max-width: 420px;
      background: rgba(0, 0, 0, 0.85);
      border-radius: 24px;
      padding: 20px 16px 24px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(0, 201, 200, 0.6);
      backdrop-filter: blur(8px);
    }
    .app-title {
      font-size: 1.6rem;
      text-align: center;
      font-weight: 700;
      margin-bottom: 20px;
    }
    .app-title span { color: var(--karisma-turquoise); }

    /* FORM TELEFONO */
    #phoneForm {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 10px;
    }
    #phoneForm input {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--karisma-turquoise);
      font-size: 1rem;
      outline: none;
    }
    #phoneForm button {
      padding: 12px;
      background: var(--karisma-turquoise);
      border: none;
      border-radius: 12px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition-fast);
    }
    #phoneForm button:hover {
      filter: brightness(1.1);
    }

    #slotSection {
      display: none;
    }

    /* Slot machine stili */
    .slot-machine {
      margin: 20px 0;
      padding: 14px;
      background: linear-gradient(145deg, #ffffff, #eef9f8);
      border-radius: var(--border-radius-main);
      border: 2px solid var(--karisma-turquoise);
    }
    .slot-window {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .reel {
      flex: 1;
      aspect-ratio: 3/4;
      background: linear-gradient(180deg, #fdfefe, #ecf4f5);
      border-radius: 12px;
      border: 2px solid #d7e1e3;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .symbol {
      font-size: 2.4rem;
      transition: transform var(--transition-fast);
    }
    .spinning .symbol {
      animation: spinAnim 0.15s linear infinite;
    }
    @keyframes spinAnim {
      0% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
      100% { transform: translateY(0); }
    }

    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    #spinButton {
      width: 100%;
      max-width: 260px;
      border-radius: 999px;
      padding: 12px 20px;
      font-size: 1rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--karisma-turquoise), var(--karisma-turquoise-dark));
      color: black;
      cursor: pointer;
    }
    .result {
      margin-top: 12px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.85);
      border: 1px solid rgba(0, 201, 200, 0.4);
      border-radius: 12px;
      text-align: center;
      opacity: 0;
      transform: translateY(10px);
      transition: 0.25s ease-out;
    }
    .result.visible {
      opacity: 1;
      transform: translateY(0);
    }

  </style>
</head>

<body>
  <div class="app">
    <h1 class="app-title">Slot <span>Karisma</span></h1>

    <form id="phoneForm">
      <p style="text-align:center; opacity:0.8;">Inserisci il tuo numero per giocare e ricevere il premio</p>
      <input type="tel" id="phoneInput" placeholder="Es. 333 1234567" required>
      <button type="submit">Conferma e Gioca</button>
      <p id="phoneError" style="color:#ff6b6b; text-align:center; display:none;">Inserisci un numero valido</p>
    </form>

    <div id="slotSection">
      <p style="text-align:center; margin-top:10px; opacity:0.85;">Premi GIRA per scoprire il tuo premio Karisma</p>

      <section class="slot-machine">
        <div class="slot-window">
          <div class="reel"><span class="symbol">üçí</span></div>
          <div class="reel"><span class="symbol">‚≠ê</span></div>
          <div class="reel"><span class="symbol">üçã</span></div>
        </div>
      </section>

      <section class="controls">
        <button id="spinButton">Gira</button>
      </section>

      <section id="result" class="result">
        <p class="result-message"></p>
        <p class="result-coupon">Codice sconto: <span class="result-coupon-code"></span></p>
      </section>
    </div>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzSgfUt16y8BM2S_U4Y8rS0YcPbihEeJQrWxP0s8Sym6Hp11_K-6j7iN-VsFOX9T0DoNg/exec";

const phoneForm = document.getElementById("phoneForm");
const phoneInput = document.getElementById("phoneInput");
const phoneError = document.getElementById("phoneError");
const slotSection = document.getElementById("slotSection");

phoneForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const phone = phoneInput.value.trim();

  if (phone.length < 5) {
    phoneError.style.display = "block";
    return;
  }
  phoneError.style.display = "none";

  await fetch(SCRIPT_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ phone })
  });

  phoneForm.style.display = "none";
  slotSection.style.display = "block";
});

/* --- SLOT MACHINE --- */

const SYMBOLS = [
  { name: "Logo Karisma (gadget esclusivo)", icon: "üåÄ" },
  { name: "Pallone da calcio Karisma", icon: "‚öΩÔ∏è" },
  { name: "Scarpe sport Karisma", icon: "üëü" },
  { name: "Sconto 10%", icon: "üí∏" },
  { name: "Calzettoni tecnici", icon: "üß¶" },
  { name: "Mystery Box Karisma", icon: "üéÅ" }
];
const COUPON_CODES = ["KARISMA10", "KARISMA-SPORT", "KARISMA-TEAM", "WIN-KARISMA", "KARISMA2025"];

const spinButton = document.getElementById("spinButton");
const resultBox = document.getElementById("result");
const resultMessageEl = resultBox.querySelector(".result-message");
const resultCouponCodeEl = resultBox.querySelector(".result-coupon-code");
const reels = document.querySelectorAll(".reel");

let spinIntervals = [];

spinButton.addEventListener("click", () => {
  if (spinIntervals.length > 0) return;

  resultBox.classList.remove("visible");

  reels.forEach(reel => {
    reel.classList.add("spinning");

    const symbolSpan = reel.querySelector(".symbol");

    const interval = setInterval(() => {
      const randomSymbol = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
      symbolSpan.textContent = randomSymbol.icon;
    }, 80);

    spinIntervals.push(interval);
  });

  const winner = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
  const coupon = COUPON_CODES[Math.floor(Math.random()*COUPON_CODES.length)];

  setTimeout(() => {
    spinIntervals.forEach(i => clearInterval(i));
    spinIntervals = [];

    reels.forEach(reel => {
      reel.classList.remove("spinning");
      reel.querySelector(".symbol").textContent = winner.icon;
    });

    resultMessageEl.innerHTML = "Hai vinto: <span>" + winner.name + "</span>";
    resultCouponCodeEl.textContent = coupon;
    resultBox.classList.add("visible");

  }, 1500);
});
</script>

</body>
</html>
